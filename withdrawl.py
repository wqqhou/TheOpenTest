from tonsdk.contract.token.nft import NFTItem
from tonsdk.contract.wallet import Wallets, WalletVersionEnum
from tonsdk.utils import Address, to_nano, bytes_to_b64str
import requests 
import config

mnemonics = list(config.MNEMONIC.split(" "))
version = WalletVersionEnum.v4r2
wc = 0

mnemonics, pub_k, priv_k, wallet = Wallets.from_mnemonics(mnemonics=mnemonics, version=version, workchain=wc)

def withdrawl(new_addr, nft):
	try:
		resp = requests.get(f'https://toncenter.com/api/v2/getWalletInformation?'
                            f'address={config.DEPOSIT_ADDRESS}'
                            f'&api_key={config.API_KEY}').json()
		seqno = resp['result']['seqno']
		body = NFTItem().create_transfer_body(Address(f'{new_addr}'), response_address= Address(f'{config.DEPOSIT_ADDRESS}'))
		query = wallet.create_transfer_message(f'{nft}', to_nano(0.05, "ton"), seqno, payload=body)
		nft_boc = bytes_to_b64str(query["message"].to_boc(False))
		data = {"boc": f'{nft_boc}'}
		tx = requests.post(f'https://toncenter.com/api/v2/sendBocReturnHash?api_key={config.API_KEY}', json = data).json()
		return tx['result']['hash']
	except: 
	    return False